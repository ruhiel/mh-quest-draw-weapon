<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>モンハンワイルズクエスト抽選ツール</title>
<style>
  table { border-collapse: collapse; }
  th, td {
    border: 1px solid #000;
    width: 50px;
    height: 40px;
    text-align: center;
  }
  .weapon-header {
    background: #000;
    color: #fff;
  }
  .circle-input {
    width: 20px;
    height: 20px;
  }
  textarea {
    width: 400px;
    height: 150px;
  }
  .section-title {
    margin-top: 40px;
    font-size: 18px;
    font-weight: bold;
  }
</style>
</head>
<body>

<button onclick="addRow()">行を追加</button>
<br><br>

<table id="hunterTable">
  <tr>
    <th class="weapon-header">名前</th>
    <th class="weapon-header"><img src="img/great-sword_ic.png" alt="大剣" width="30"/></th>
    <th class="weapon-header"><img src="img/long-sword_ic.png" alt="太刀" width="30"/></th>
    <th class="weapon-header"><img src="img/sword-and-shield_ic.png" alt="片手剣" width="30"/></th>
    <th class="weapon-header"><img src="img/dual-blades_ic.png" alt="双剣" width="30"/></th>
    <th class="weapon-header"><img src="img/hammer_ic.png" alt="ハンマー" width="30"/></th>
    <th class="weapon-header"><img src="img/hunting-horn_ic.png" alt="狩猟笛" width="30"/></th>
    <th class="weapon-header"><img src="img/lance_ic.png" alt="ランス" width="30"/></th>
    <th class="weapon-header"><img src="img/gunlance_ic.png" alt="ガンランス" width="30"/></th>
    <th class="weapon-header"><img src="img/switch-axe_ic.png" alt="スラアク" width="30"/></th>
    <th class="weapon-header"><img src="img/charge-blade_ic.png" alt="チャアク" width="30"/></th>
    <th class="weapon-header"><img src="img/insect-glaive_ic.png" alt="操虫棍" width="30"/></th>
    <th class="weapon-header"><img src="img/light-bowgun_ic.png" alt="ライトボウガン" width="30"/></th>
    <th class="weapon-header"><img src="img/heavy-bowgun_ic.png" alt="ヘビィボウガン" width="30"/></th>
    <th class="weapon-header"><img src="img/bow_ic.png" alt="弓" width="30"/></th>
  </tr>
</table>

<script>
function addRow() {
  const table = document.getElementById('hunterTable');
  const row = document.createElement('tr');
  let html = '<td><input type="text" placeholder="名前"></td>';
  for (let i = 0; i < 14; i++) html += '<td><input type="checkbox"></td>';
  row.innerHTML = html;
  table.appendChild(row);
}

// 初期3行追加
/*
['あかみ', 'ゆっぴ', 'ルヒエル'].forEach(name => {
  const table = document.getElementById('hunterTable');
  const row = document.createElement('tr');
  let html = `<td><input type="text" value="${name}"></td>`;
  for (let i = 0; i < 14; i++) html += '<td><input type="checkbox"></td>';
  row.innerHTML = html;
  table.appendChild(row);
});
*/

// ---- PT編成（武器は空欄） ----
function createParty() {
  const rows = Array.from(document.querySelectorAll('#hunterTable tr')).slice(1);
  const members = rows.map(row => ({ name: row.children[0].querySelector('input').value.trim() }));

  const resultBox = document.getElementById('partyResult');
  resultBox.innerHTML = "";

  if (members.length === 0) {
    resultBox.textContent = "ハンターがいません";
    return;
  }

  // ランダムシャッフル
  for (let i = members.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [members[i], members[j]] = [members[j], members[i]];
  }

  const parties = [];
  let remaining = members.slice();

  while (remaining.length > 0) {
    let groupSize;

    if (remaining.length > 8) groupSize = 4; // 多いときは4人
    else if (remaining.length === 7) groupSize = 4; // 7人 → 4+3
    else if (remaining.length === 6) groupSize = 3; // 6人 → 3+3
    else if (remaining.length === 5) groupSize = 3; // 5人 → 3+2
    else groupSize = remaining.length;          // 残り4人以下はその人数

    parties.push(remaining.slice(0, groupSize));
    remaining = remaining.slice(groupSize);
  }

  // 表形式で描画（武器は空欄）
  let html = "";
  parties.forEach((pt, idx) => {
    html += `<h3>PT${idx + 1}</h3>`;
    html += `<table border="1" style="border-collapse: collapse; margin-bottom:20px;">
               <tr><th>名前</th><th>武器</th></tr>`;
    pt.forEach(member => {
      html += `<tr><td>${member.name}</td><td class="weapon-cell"></td></tr>`;
    });
    html += `</table>`;
  });

  resultBox.innerHTML = html;
}
// ---- 抽選：モンスター1体 + メンバーにチェック済み武器からランダム付与 ----
function randomDraw() {
  const monsterText = document.querySelector("textarea").value.trim();
  const monsterList = monsterText.split("\n").map(m => m.trim()).filter(m => m);

  if (monsterList.length === 0) {
    alert("モンスターが未入力です");
    return;
  }

  // モンスターをランダム選択
  const monster = monsterList[Math.floor(Math.random() * monsterList.length)];
  document.getElementById("monsterDisplay").textContent = "【討伐対象】 " + monster;

  // 武器アイコン対応配列
  const weaponIcons = [
    "img/great-sword_ic.png",
    "img/long-sword_ic.png",
    "img/sword-and-shield_ic.png",
    "img/dual-blades_ic.png",
    "img/hammer_ic.png",
    "img/hunting-horn_ic.png",
    "img/lance_ic.png",
    "img/gunlance_ic.png",
    "img/switch-axe_ic.png",
    "img/charge-blade_ic.png",
    "img/insect-glaive_ic.png",
    "img/light-bowgun_ic.png",
    "img/heavy-bowgun_ic.png",
    "img/bow_ic.png"
  ];

  const resultTables = document.querySelectorAll("#partyResult table");
  resultTables.forEach(table => {
    const rows = table.querySelectorAll("tr");
    rows.forEach((row, idx) => {
      if (idx === 0) return; // ヘッダー
      const name = row.children[0].textContent.trim();
      const weaponCell = row.children[1];
      weaponCell.innerHTML = "";

      // hunterTableからその人のチェック済み武器を取得
      const hunterRows = document.querySelectorAll("#hunterTable tr");
      let weaponList = [];
      hunterRows.forEach(hRow => {
        const hName = hRow.children[0].querySelector('input')?.value.trim();
        if (hName === name) {
          const checks = hRow.querySelectorAll('td:nth-child(n+2) input');
          checks.forEach((chk, i) => {
            if (chk.checked) weaponList.push(i); // 列番号を保存
          });
        }
      });

      if (weaponList.length === 0) {
        weaponCell.textContent = "なし";
        return;
      }

      // ランダムで1つ選択してアイコン表示
      const pick = weaponList[Math.floor(Math.random() * weaponList.length)];
      const img = document.createElement("img");
      img.src = weaponIcons[pick];
      img.alt = "武器";
      img.width = 30;
      weaponCell.appendChild(img);
    });
  });
}
</script>

<div class="section-title">モンスター一覧</div>
<textarea>
ババコンガ
ゴアマガラ
</textarea>
<br><br>

<div id="monsterDisplay" style="font-size:20px; font-weight:bold; margin-bottom:10px;"></div>

<button onclick="createParty()">PT編成</button>
<button onclick="randomDraw()">抽選ボタン</button>

<div id="partyResult"></div>
</body>
</html>
